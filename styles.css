/* =========================================================
   Klondike ‚Äî responsive for Telegram WebView (iOS/Android)
   –í–µ—Ä—Å–∏—è: iPhone 16 tuned ‚Äî –∫–æ–ª–æ–Ω–∫–∏ –≤–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ä–æ–≤–Ω–æ –≤ 7 √ó width
   ========================================================= */

/* ============ Variables & Theme ============ */
:root{
  /* colors */
  --bg-color:#ffffff; --text-color:#000000;
  --card-bg:#ffffff;  --card-border:#cccccc;
  --slot-bg:#f0f0f0;  --slot-border:#dddddd;
  --btn-primary-bg:#007bff; --btn-primary-color:#ffffff;
  --btn-secondary-bg:#6c757d; --btn-secondary-color:#ffffff;
  --modal-bg:rgba(0,0,0,.5); --modal-content-bg:#ffffff;
  --red-suit:#dc3545; --black-suit:#000000;

  /* viewport from Telegram (fallbacks) */
  --vw: var(--tg-vw, 100vw);
  --vh: var(--tg-vh, 100dvh);

  /* content safe area (–∏—Å—Ç–∏–Ω–∞ –≤ Telegram WebView) */
  --csafe-top:    var(--tg-csafe-top,    env(safe-area-inset-top, 0px));
  --csafe-right:  var(--tg-csafe-right,  env(safe-area-inset-right, 0px));
  --csafe-bottom: var(--tg-csafe-bottom, env(safe-area-inset-bottom, 0px));
  --csafe-left:   var(--tg-csafe-left,   env(safe-area-inset-left, 0px));

  /* layout chrome */
  --ui-header-h: 48px;

  /* === —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –∏ –∫–∞—Ä—Ç—ã ===
     –°–Ω–∞—á–∞–ª–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ–±—â—É—é —à–∏—Ä–∏–Ω—É –∑–æ–Ω—ã tableau,
     –∑–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è–µ–º —Ç–æ—á–Ω—É—é —à–∏—Ä–∏–Ω—É –æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –∏ –∫–∞—Ä—Ç—ã ‚Äî —Ç–∞–∫ 7 –∫–æ–ª–æ–Ω–æ–∫ –≤—Å–µ–≥–¥–∞ –≤–ª–µ–∑–∞—é—Ç. */
  --gap: 8px;
  --tableau-maxw: min( clamp(230px, 85vw, 760px), calc(var(--vw) - (var(--csafe-left) + var(--csafe-right) + 16px)) );
  --cols: 7;
  --colw: calc( (var(--tableau-maxw) - (var(--cols) - 1) * var(--gap)) / var(--cols) );
  --card-max: clamp(40px, var(--colw), 78px);
  --card-h: calc(var(--card-max) * 1.4); /* aspect 2.5:3.5 ‚âà 1:1.4 */

  --font-s: clamp(8px, 2.2vw, 12px);
  --font-m: clamp(10px, 2.6vw, 15px);

  /* —Ä–µ–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ–¥ —Å—Ç–æ–ª */
  --avail-h: calc(var(--vh) - var(--csafe-top) - var(--csafe-bottom) - var(--ui-header-h));

  /* –æ—Ç–±–æ–π–Ω–∏–∫ —Å–Ω–∏–∑—É: content safe area + –∑–∞–ø–∞—Å (—É—Å–∏–ª–µ–Ω–Ω—ã–π –¥–ª—è iPhone 16 / —Ç–µ–ª–µ–≥—Ä–∞–º-–≤–µ–±–≤—å—é) */
  --pad-bottom: calc(var(--csafe-bottom) + 44px);

  /* —Å—Ç–µ–∫ –∫–∞—Ä—Ç (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) */
  --stack-open:   calc(var(--card-h) * -0.36);
  --stack-closed: calc(var(--card-h) * -0.28);
}

[data-theme="dark"]{
  --bg-color:#1a1a1a; --text-color:#ffffff;
  --card-bg:#2d2d2d;  --card-border:#444444;
  --slot-bg:#333333;  --slot-border:#555555;
  --modal-content-bg:#2d2d2d;
  --red-suit:#ff6b6b; --black-suit:#ffffff;
}

/* ============ Reset / base ============ */
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  color:var(--text-color);
  background:linear-gradient(135deg,#ffffff 0%,#e3f2fd 30%,#1976d2 70%,#0d47a1 100%);
  min-height:var(--vh);
  overflow-x:hidden;
  overscroll-behavior-y:none;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}

/* ============ Layout ============ */
.game-container{
  width:100%;
  min-height:var(--vh);
  padding: calc(6px + var(--csafe-top))
           calc(6px + var(--csafe-right))
           calc(6px + var(--pad-bottom))
           calc(6px + var(--csafe-left));
  display:flex; flex-direction:column; gap:8px;

  overflow-y:auto;
  scroll-padding-top:calc(var(--ui-header-h) + 8px);
  scroll-padding-bottom:calc(var(--pad-bottom) + 120px); /* –±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
  position:relative; z-index:1;
}

/* —Å—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π –æ—Ç–±–æ–π–Ω–∏–∫ ‚Äî –µ—Å–ª–∏ webview —Å—Ä–µ–∂–µ—Ç –ø–∞–¥–¥–∏–Ω–≥–∏ */
.game-container::after{
  content:""; display:block; height:calc(var(--pad-bottom) + 120px); flex:0 0 auto;
}

.game-header{
  position:sticky; top:var(--csafe-top); z-index:5;
  display:flex; align-items:center; justify-content:space-between;
  gap:8px;
  padding:8px calc(10px + var(--csafe-right)) 6px calc(10px + var(--csafe-left));
  min-height:var(--ui-header-h);
  background:var(--bg-color);
}
.game-info{display:flex;gap:10px;font-size:10px}
.timer,.moves{display:flex;flex-direction:column;align-items:flex-start}
.timer-label,.moves-label{font-weight:600;opacity:.9}
.timer-value,.moves-value{font-size:var(--font-m);font-weight:800}
.timer.not-started{animation:pulse-timer 2s infinite}
.timer.not-started .timer-value{color:var(--btn-primary-bg);font-weight:900}
.timer-hint{font-size:8px;opacity:.7;margin-top:2px;display:none}
.timer.not-started .timer-hint{display:block;animation:fade-in-out 2s infinite}

.game-controls{display:flex;gap:6px;flex-wrap:wrap}
.btn{
  padding:7px 12px;border:0;border-radius:8px;
  font-size:12px;font-weight:600;min-height:36px;min-width:72px;
  cursor:pointer;transition:opacity .2s,transform .2s;
  touch-action:manipulation;
}
.btn-primary{background:var(--btn-primary-bg);color:var(--btn-primary-color)}
.btn-secondary{background:var(--btn-secondary-bg);color:var(--btn-secondary-color)}
.btn-hint{background:linear-gradient(45deg,#ffd700,#ffed4e);color:#333;font-weight:700}
.btn:hover{opacity:.9;transform:translateY(-1px)}
.btn:active{transform:translateY(0)}

/* ============ Board ============ */
.game-board{
  display:flex; flex-direction:column; gap:8px; flex:1;
  padding-bottom:var(--pad-bottom);
}

/* Foundation */
.foundation-area{
  display:grid; grid-template-columns:repeat(4,minmax(0,1fr));
  gap:8px; margin-inline:auto; margin-bottom:6px;
  width:100%; max-width:min( clamp(150px, 48vw, 380px), var(--tableau-maxw) );
}
.foundation-slot{
  aspect-ratio:2.5/3.5; min-height:58px; max-width:var(--card-max);
  background:var(--slot-bg); border:2px dashed var(--slot-border);
  border-radius:10px; display:flex; align-items:center; justify-content:center;
  transition:border-color .2s;
}
.foundation-slot:hover{border-color:var(--btn-primary-bg)}

/* Stock / Waste */
.stock-waste-area{
  display:flex; gap:8px; justify-content:center;
  width:100%; max-width:min( clamp(130px,45vw,210px), var(--tableau-maxw) );
  margin-inline:auto;
}
.stock-container,.waste-container{flex:1; max-width:var(--card-max)}
.stock,.waste{
  aspect-ratio:2.5/3.5; min-height:58px; max-width:var(--card-max);
  background:var(--slot-bg); border:2px solid var(--slot-border);
  border-radius:10px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; position:relative; transition:border-color .2s;
}
.stock:hover,.waste:hover{border-color:var(--btn-primary-bg)}

/* Tableau */
.tableau-area{
  display:grid;
  grid-template-columns:repeat(7, minmax(0, 1fr));
  gap:var(--gap);
  width:100%;
  max-width:var(--tableau-maxw);
  margin-inline:auto;
  flex:1;
  padding-bottom:var(--pad-bottom);
}
.tableau-slot{
  background:var(--slot-bg); border:2px dashed var(--slot-border);
  border-radius:10px;

  /* min-height –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤—ã—Å–æ—Ç—ã: 26‚Äì30% (–¥–∏–Ω–∞–º–∏—á–Ω–æ) */
  --mh-base: max(var(--avail-h), 320px);
  min-height: clamp(86px, calc(var(--mh-base) * 0.28), 360px);

  padding:5px; position:relative; transition:border-color .2s;
}
.tableau-slot:hover{border-color:var(--btn-primary-bg)}

/* ============ Cards ============ */
.card{
  width:100%; max-width:var(--card-max); aspect-ratio:2.5/3.5;
  background:var(--card-bg); border:1px solid var(--card-border); border-radius:8px;
  display:flex; flex-direction:column; justify-content:space-between;
  padding:3px; font-size:var(--font-s); font-weight:800;
  cursor:grab; position:relative; user-select:none;
  box-shadow:0 2px 4px rgba(0,0,0,.08);
  transition:transform .2s, opacity .2s; touch-action:none;
}
.card:active{cursor:grabbing}
.card.face-down{background:linear-gradient(45deg,#2c3e50,#34495e); color:transparent}
.card.face-down::before{
  content:"‚ô†"; position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%); font-size:calc(var(--font-m) + 6px);
  color:var(--text-color); opacity:.85;
}
.card.red{color:var(--red-suit)} .card.black{color:var(--black-suit)}
.card-top,.card-bottom{display:flex;justify-content:space-between;align-items:flex-start}
.card-bottom{transform:rotate(180deg)}
.card-value{font-size:calc(var(--font-s) + 2px); font-weight:900}
.card-suit{font-size:calc(var(--font-s) + 3px)}

.tableau-slot .card{margin-bottom:var(--stack-open); z-index:1}
.tableau-slot .card.face-down{margin-bottom:var(--stack-closed)}
.tableau-slot .card:last-child{margin-bottom:0}

/* ============ Drag & Drop ============ */
.card.dragging{opacity:.9; transform:scale(1.03) rotate(1.5deg); z-index:1000}
.foundation-slot.drag-over,.tableau-slot.drag-over,.card.drag-over{
  border-color:var(--btn-primary-bg); background-color:rgba(0,123,255,.08);
}

/* ============ Modal & misc ============ */
.modal{
  position:fixed; inset:0; background:var(--modal-bg);
  display:flex; align-items:center; justify-content:center; z-index:1000;
  padding-top:var(--csafe-top);
}
.modal.hidden{display:none}
.modal-content{
  background:var(--modal-content-bg); padding:20px; border-radius:12px; text-align:center;
  max-width:min(90%,480px); max-height:calc(80dvh - var(--csafe-top)); overflow:auto;
}

/* background animation (–æ–±–ª–µ–≥—á—ë–Ω) */
.background-animation{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}
.floating-card{
  position:absolute; width:40px; height:56px;
  background:linear-gradient(45deg,#2196f3,#1976d2);
  border:1px solid #1565c0; border-radius:6px; opacity:.22;
  animation:float 18s infinite linear;
}
.floating-card::before{
  content:"‚ô†"; position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center; color:#fff; opacity:.8;
}
@keyframes float{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-80px) rotate(360deg)}}

/* ============ HiDPI ============ */
.card,.slot{will-change:transform}
@media (-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){.card{border-width:.5px}}

/* ============ Height-based compression (–∫–æ–≥–¥–∞ –º–∞–ª–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏) ============ */
@media (max-height:860px){
  :root{
    --stack-open:calc(var(--card-h)*-0.34);
    --stack-closed:calc(var(--card-h)*-0.27);
  }
  .tableau-slot{min-height: clamp(84px, calc(max(var(--avail-h), 300px) * 0.26), 330px)}
}
@media (max-height:800px){
  :root{
    --stack-open:calc(var(--card-h)*-0.32);
    --stack-closed:calc(var(--card-h)*-0.25);
  }
  .tableau-slot{min-height: clamp(80px, calc(max(var(--avail-h), 270px) * 0.24), 300px)}
}
@media (max-height:740px){
  :root{
    --stack-open:calc(var(--card-h)*-0.30);
    --stack-closed:calc(var(--card-h)*-0.23);
  }
  .tableau-slot{min-height: clamp(76px, calc(max(var(--avail-h), 250px) * 0.22), 280px)}
}

/* ============ Width breakpoints (–±–µ–∑ ¬´–º–æ–¥–µ–ª–µ–π¬ª) ============ */
@media (max-width:768px){
  .game-header{flex-wrap:wrap; align-items:flex-start}
  .foundation-area{grid-template-columns:repeat(2,1fr)}
  .tableau-area{grid-template-columns:repeat(7,1fr)} /* 7 –∫–æ–ª–æ–Ω–æ–∫ –≤—Å–µ–≥–¥–∞, –Ω–æ —É–∂–µ ‚Äî –∏–∑ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ maxw */
}

/* ============ Animations for timer/hints ============ */
@keyframes pulse-timer{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.75;transform:scale(1.05)}}
@keyframes fade-in-out{0%,100%{opacity:.7}50%{opacity:1}}

/* ============ Nickname / Stats / Leaderboard (–∫–∞–∫ –±—ã–ª–æ) ============ */
.nickname-input-container{margin:20px 0}
.nickname-input{
  width:100%;padding:12px;border:2px solid var(--slot-border);border-radius:8px;
  font-size:16px;background:var(--card-bg);color:var(--text-color);margin-bottom:8px
}
.nickname-input:focus{outline:none;border-color:var(--btn-primary-bg)}
.nickname-hint{font-size:12px;color:var(--text-color);opacity:.7;text-align:center}

.leaderboard{margin:20px 0;max-height:300px;overflow-y:auto}
.leaderboard-list{display:flex;flex-direction:column;gap:8px}
.leaderboard-item{
  display:flex;align-items:center;padding:12px;background:var(--slot-bg);
  border-radius:8px;border:1px solid var(--slot-border);transition:.2s
}
.leaderboard-item.rank-1{background:linear-gradient(45deg,#ffd700,#ffed4e);border-color:#ffc107;color:#333;font-weight:700}
.leaderboard-item.rank-2{background:linear-gradient(45deg,#c0c0c0,#e0e0e0);border-color:#9e9e9e;color:#333;font-weight:700}
.leaderboard-item.rank-3{background:linear-gradient(45deg,#cd7f32,#daa520);border-color:#b8860b;color:#fff;font-weight:700}
.leaderboard-rank{font-size:18px;font-weight:700;margin-right:12px;min-width:30px}
.leaderboard-rank.rank-1::before{content:"ü•á "}
.leaderboard-rank.rank-2::before{content:"ü•à "}
.leaderboard-rank.rank-3::before{content:"ü•â "}
.leaderboard-info{flex:1;display:flex;flex-direction:column}
.leaderboard-nickname{font-weight:700;font-size:14px}
.leaderboard-stats{font-size:12px;opacity:.8;margin-top:2px}
.stats-footer{margin-top:16px;padding:12px;background:var(--slot-bg);border-radius:8px;text-align:center;font-size:14px}
.stats-footer p{margin:0;font-weight:600}

/* ============ Win Stats ============ */
.win-stats{margin:14px 0;padding:12px;background:var(--slot-bg);border-radius:10px}
.win-stats p{margin:5px 0;font-weight:600}

/* ============ Card animations / Hints ============ */
@keyframes cardFlip{from{transform:rotateY(0)}to{transform:rotateY(180deg)}}
.card.flipping{animation:cardFlip .3s ease-in-out}
@keyframes cardMove{from{transform:scale(1)}50%{transform:scale(1.05)}to{transform:scale(1)}}
.card.moving{animation:cardMove .2s ease-in-out}

.hint-highlight{
  animation:hint-pulse 1s ease-in-out infinite;
  border-color:#ffd700 !important; background-color:rgba(255,215,0,.1) !important;
  box-shadow:0 0 10px rgba(255,215,0,.5);
}
@keyframes hint-pulse{0%,100%{box-shadow:0 0 10px rgba(255,215,0,.5)}50%{box-shadow:0 0 20px rgba(255,215,0,.8)}}
@keyframes hint-fade-in-out{
  0%{opacity:0;transform:translate(-50%,-50%) scale(.8)}
  20%{opacity:1;transform:translate(-50%,-50%) scale(1)}
  80%{opacity:1}
  100%{opacity:0;transform:translate(-50%,-50%) scale(.8)}
}
